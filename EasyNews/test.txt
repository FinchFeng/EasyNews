<div class="article-content">
        <img src="http://p1.pstatp.com/large/13230009ef3445d962bb" img_width="900" img_height="716" alt="修复 Ubuntu 中“Unable to lock the administration directory”的错误"
                onerror="javascript:errorimg.call(this);" >
<p>-- Aaron Kili</p>
<p>本文导航</p>
<ul>
        <li>
                <p>-1、找出并杀掉所有 apt-get 或者 apt 进程28%</p>
        </li>
        <li>
                <p>-2、 删除锁定的文件52%</p>
        </li>
</ul>
<blockquote>编译自： http://www.tecmint.com/fix-unable-to-lock-the-administration-directory-var-lib-dpkg-lock<br>作者： Aaron Kili<br>译者： geekpi</blockquote>
<p>在 Ubuntu 或者它的衍生版如 Linux Mint（我已经作为日常工作使用的系统）中使用 apt-get 命令或者其相对更新的APT 管理工具时，你可能会在命令行中看到一个<code>unable to lock the administration directory (/var/lib/dpkg/) is another process using it</code>的错误。</p>
<p>这个错误尤其对那些对这个错误原因不了解的 Linux（Ubuntu）新手而言更加恼人。</p>
<p>下面是一个例子，展示了出现在 Ubuntu 16.10 上的文件锁定错误：</p><pre><ol><li><p><code>tecmint@TecMint:~$ sudo apt install neofetch</code></p></li><li><p><code>[sudo] password for tecmint:</code></p></li><li><p><code>E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)</code></p></li><li><p><code>E: Unable to lock the administration directory (/var/lib/dpkg), is another process using it?</code></p></li></ol></pre>
<p>下面的输出是另外一个可能显示的错误：</p><pre><ol><li><p><code>E: Could not get lock /var/lib/apt/lists/lock - open (11: Resource temporarily unavailable)</code></p></li><li><p><code>E: Unable to lock directory /var/lib/apt/lists/ </code></p></li><li><p><code>E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable) </code></p></li><li><p><code>E: Unable to lock the administration directory (/var/lib/dpkg/), is another process using it?</code></p></li></ol></pre>
<p>你将来遇到这个错误该怎么去解决？一共有几种方法处理这个错误，但是本篇中我们会用两种或许是最简单和最有效的方法来解决它。</p>
<p>1、找出并杀掉所有 apt-get 或者 apt 进程</p>
<p>运行下面的命令来生成所有含有 apt 的进程列表[1]，你可以使用<code>ps</code>和grep 命令[2]并用管道组合来得到含有 apt 或者 apt-get 的进程。</p><pre><ol><li><p><code>$ ps -A | grep apt</code></p></li></ol></pre>
<p>找出 apt 以及 apt-get 进程</p>
<p>你可以看到上面命令输出的每个 apt-get 或者 apt 进程，使用下面的命令杀掉每个进程[3]。</p>
<p>上面截图中的第一列是进程 ID（PID）。</p><pre><ol><li><p><code>$ sudo kill -9 processnumber</code></p></li><li><p><code>或者</code></p></li><li><p><code>$ sudo kill -SIGKILL processnumber</code></p></li></ol></pre>
<p>比如，下面命令中的<code>9</code>是<code>SIGKILL</code>的信号数，它会杀掉第一个 apt 进程：</p><pre><ol><li><p><code>$ sudo kill -9 13431</code></p></li><li><p><code>或者</code></p></li><li><p><code>$ sudo kill -SIGKILL 13431</code></p></li></ol></pre>
<p>2、 删除锁定的文件</p>
<p>锁定的文件会阻止 Linux 系统中某些文件或者数据的访问，这个概念也存在于 Windows 或者其他的操作系统中。</p>
<p>一旦你运行了 apt-get 或者 apt 命令，锁定文件将会创建于 <code>/var/lib/apt/lists/</code>、<code>/var/lib/dpkg/</code>、<code>/var/cache/apt/archives/</code>中。</p>
<p>这有助于运行中的 apt-get 或者 apt 进程能够避免被其它需要使用相同文件的用户或者系统进程所打断。当该进程执行完毕后，锁定文件将会删除。</p>
<p>重要提醒：万一你在没有看到 apt-get 或者 apt 进程的情况下在上面两个不同的文件夹中看到了锁定文件，这是因为进程由于某个原因被杀掉了，因此你需要删除锁定文件来避免该错误。</p>
<p>首先运行下面的命令来移除 <code>/var/lib/dpkg/</code>文件夹下的锁定文件：</p><pre><ol><li><p><code>$ sudo rm /var/lib/dpkg/lock</code></p></li></ol></pre>
<p>之后像下面这样强制重新配置软件包：</p><pre><ol><li><p><code>$ sudo dpkg --configure -a</code></p></li></ol></pre>
<p>也可以删除 <code>/var/lib/apt/lists/</code>以及缓存文件夹下的锁定文件：</p><pre><ol><li><p><code>$ sudo rm /var/lib/apt/lists/lock</code></p></li><li><p><code>$ sudo rm /var/cache/apt/archives/lock</code></p></li></ol></pre>
<p>接下来，更新你的软件包源列表：</p><pre><ol><li><p><code>$ sudo apt update</code></p></li><li><p><code>或者</code></p></li><li><p><code>$ sudo apt-get update</code></p></li></ol></pre>
<p>总结一下，对于 Ubuntu（以及它的衍生版）用户在使用 apt-get 或者 apt 也叫 aptitude 命令[4]时遇到的问题，我们已经用两种方法来解决了。</p>
<p>你有什么可以分享出来的有效的方法来处理这个错误么？在下面的评论区联系我们。</p>
<p>除此之外，你可能还希望了解如何找出并杀掉运行的进程[5]，你可以阅读这篇用 kill、pkill、killall 来中止进程[6]指南来了解。</p>
<p>作者：Aaron Kili[7] 译者：geekpi校对：wxy</p>
<p>本文由 LCTT[8] 组织编译，Linux中国荣誉推出</p>
<p>推荐文章</p>
<p class="footnote">本文为头条号作者发布，不代表今日头条立场。</p>
</div>